{% extends "basic.html" %}
{% load static %}

{% block body %}
<main class="main">
  <div class="container my-5">

    <!-- Back link -->
    <div class="mb-3">
      <a href="{% url 'blog_list' %}" class="btn btn-sm btn-outline-secondary">
        &larr; Back to Blog
      </a>
    </div>

    <!-- Featured / Header Image -->
    <div class="mb-4">
      {% if post.image %}
        <img src="{{ post.image.url }}" alt="{{ post.title|default:'Blog Image' }}" class="img-fluid rounded w-100" loading="lazy">
      {% else %}
        <img src="{% static 'assets/img/default.jpg' %}" alt="Default Blog Image" class="img-fluid rounded w-100" loading="lazy">
      {% endif %}
    </div>

    <!-- Title -->
    <h1 class="mb-3">{{ post.title|default:"No Title" }}</h1>

    <!-- Meta -->
    <div class="mb-4 text-muted small">
      <span class="me-3"><i class="bi bi-calendar"></i> {{ post.created_at|date:"M d, Y" }}</span>
      <span><i class="bi bi-person"></i> {{ post.author_name|default:"Unknown Author" }}</span>
    </div>

    <!-- Content -->
    <article class="blog-content mb-5">
      {% if content_blocks %}
        {% for block in content_blocks %}
          {% if block.type == "p" %}
            <p class="mb-3">{{ block.text|safe }}</p>

          {% elif block.type == "img" %}
            <div class="mb-4">
              {% if block.image_url %}
                <img src="{{ block.image_url }}" alt="{{ post.title }}" class="img-fluid rounded w-100" loading="lazy">
              {% else %}
                <img src="{% static 'assets/img/default.jpg' %}" alt="Default Image" class="img-fluid rounded w-100" loading="lazy">
              {% endif %}
            </div>

          {% elif block.type == "h2" %}
            <h2 class="mt-4 mb-3">{{ block.text }}</h2>

          {% elif block.type == "quote" %}
            <blockquote class="blockquote ps-3 border-start border-3 mb-3">
              <p class="mb-1">{{ block.text }}</p>
              {% if block.author %}
                <footer class="blockquote-footer">{{ block.author }}</footer>
              {% endif %}
            </blockquote>
          {% endif %}
        {% endfor %}
      {% else %}
        {% if post.content %}
          <div class="mb-4">{{ post.content|linebreaks }}</div>
        {% else %}
          <p>Content not available.</p>
        {% endif %}
      {% endif %}
    </article>

    <!-- Author box -->
    {% if post.author_name or post.author %}
      <div class="author-info mb-5 p-3 bg-light rounded shadow-sm d-flex align-items-center">
        {% if post.author and post.author.profile_image %}
          <img src="{{ post.author.profile_image.url }}" class="rounded-circle me-3" width="64" height="64" alt="{{ post.author.get_full_name }}">
        {% else %}
          <img src="{% static 'assets/img/default-avatar.png' %}" class="rounded-circle me-3" width="64" height="64" alt="Author avatar">
        {% endif %}
        <div>
          <strong>{{ post.author.get_full_name|default:post.author_name|default:"Unknown Author" }}</strong><br>
          {% if post.author and post.author.bio %}
            <small class="text-muted">{{ post.author.bio }}</small>
          {% endif %}
        </div>
      </div>
    {% endif %}

    <!-- Post footer -->
    <div class="post-footer mt-4 pt-3 border-top">
      <a href="{% url 'blog_list' %}" class="me-3">‚Üê Back to all posts</a>
      <span class="text-muted">Published {{ post.created_at|date:"F j, Y" }}</span>
    </div>

  </div>
</main>
{% endblock %}
